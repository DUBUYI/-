const blockprofile = [
//'ë§í¬',
];

// íŒì—… ì—´ê³  ì°¨ë‹¨ ì‹œë„
function tryBlock(popup, retryCount = 0, onComplete) {
  if (!popup || popup.closed) {
    onComplete();
    return;
  }

  try {
    const moreBtn = popup.document.querySelector('#profile_action_dropdown_link');
    if (moreBtn) moreBtn.click();

    setTimeout(() => {
      const blockBtn = popup.document.querySelector('#profile_action_dropdown a[href*="ConfirmBlock"]');
      if (blockBtn) {
        blockBtn.click();

        setTimeout(() => {
          const confirmBtn = popup.document.querySelector("body div.newmodal .btn_green_steamui.btn_medium");
          if (confirmBtn) confirmBtn.click();

          setTimeout(() => {
            popup.close();
            onComplete();
          }, 625); // ë”œë ˆì´ ë°˜ìœ¼ë¡œ ì¤„ì„ (ì›ë˜ 1250ms â†’ 625ms)
        }, 375); // ë”œë ˆì´ ë°˜ìœ¼ë¡œ ì¤„ì„ (ì›ë˜ 750ms â†’ 375ms)
      } else {
        if (retryCount < 1) {
          console.warn(`ì°¨ë‹¨ ë²„íŠ¼ ì—†ìŒ. ìƒˆë¡œê³ ì¹¨ ì‹œë„ ${retryCount + 1}/1`);
          popup.location.reload();
          setTimeout(() => {
            tryBlock(popup, retryCount + 1, onComplete);
          }, 250); // ë”œë ˆì´ ë°˜ìœ¼ë¡œ ì¤„ì„ (ì›ë˜ 500ms â†’ 250ms)
        } else {
          console.warn(`ì°¨ë‹¨ ì‹¤íŒ¨ (ìµœëŒ€ ì¬ì‹œë„): ì°½ ë‹«ê¸°`);
          popup.close();
          onComplete();
        }
      }
    }, 125); // ë”œë ˆì´ ë°˜ìœ¼ë¡œ ì¤„ì„ (ì›ë˜ 250ms â†’ 125ms)
  } catch (e) {
    console.warn('ë¬¸ì„œ ì ‘ê·¼ ì‹¤íŒ¨:', e);
    onComplete();
  }
}

// ìˆœì°¨ ì‹¤í–‰ í•¨ìˆ˜
function processProfilesSequentially(profiles, index = 0) {
  if (index >= profiles.length) {
    console.log('âœ… ëª¨ë“  í”„ë¡œí•„ ì°¨ë‹¨ ì‹œë„ ì™„ë£Œ');
    return;
  }

  const url = profiles[index];
  const popup = window.open(url);

  if (!popup) {
    console.warn(`ğŸš« íŒì—… ì°¨ë‹¨ë¨ ë˜ëŠ” ì‹¤íŒ¨: ${url}`);
    // ë‹¤ìŒ í”„ë¡œí•„ë¡œ ì´ë™ (0.375ì´ˆ í›„)
    setTimeout(() => processProfilesSequentially(profiles, index + 1), 375); // ë”œë ˆì´ ë°˜ìœ¼ë¡œ ì¤„ì„ (ì›ë˜ 750ms â†’ 375ms)
    return;
  }

  console.log(`ğŸ”— í”„ë¡œí•„ ì—´ê¸°: ${url}`);

  // 1.25ì´ˆ í›„ ì°¨ë‹¨ ì‹œë„ ì‹œì‘ (ì›ë˜ 2.5ì´ˆ â†’ 1250ms)
  setTimeout(() => {
    tryBlock(popup, 0, () => {
      // ë‹¤ìŒ í”„ë¡œí•„ë¡œ ì´ë™
      setTimeout(() => processProfilesSequentially(profiles, index + 1), 250); // ë”œë ˆì´ ë°˜ìœ¼ë¡œ ì¤„ì„ (ì›ë˜ 500ms â†’ 250ms)
    });
  }, 1250); // ë”œë ˆì´ ë°˜ìœ¼ë¡œ ì¤„ì„ (ì›ë˜ 2500ms â†’ 1250ms)
}

// ì‹œì‘
processProfilesSequentially(blockprofile);
