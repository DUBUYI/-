// âœ… 1. ì‚¬ìš©ì ì…ë ¥ ë°›ì•„ ë§í¬ ìë™ íŒŒì‹±
const rawInput = prompt("ì°¨ë‹¨í•  Steam í”„ë¡œí•„ ë§í¬ë“¤ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.\n(ì¤„ë°”ê¿ˆ, ì‰¼í‘œ, ê³µë°± ëª¨ë‘ ì¸ì‹ë©ë‹ˆë‹¤)");

const blockprofile = rawInput
  .split(/\s+|,|\n/) // ê³µë°±, ì‰¼í‘œ, ì¤„ë°”ê¿ˆ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬
  .map(link => link.trim())
  .filter(link => link.startsWith("http")); // ìœ íš¨í•œ ë§í¬ë§Œ ì‚¬ìš©

// âœ… 2. íŒì—… ì—´ê³  ì°¨ë‹¨ ì‹œë„
function tryBlock(popup, retryCount = 0, onComplete) {
  if (!popup || popup.closed) {
    onComplete();
    return;
  }

  try {
    const moreBtn = popup.document.querySelector('#profile_action_dropdown_link');
    if (moreBtn) moreBtn.click();

    setTimeout(() => {
      const blockBtn = popup.document.querySelector('#profile_action_dropdown a[href*="ConfirmBlock"]');
      if (blockBtn) {
        blockBtn.click();

        setTimeout(() => {
          const confirmBtn = popup.document.querySelector("body div.newmodal .btn_green_steamui.btn_medium");
          if (confirmBtn) confirmBtn.click();

          setTimeout(() => {
            popup.close();
            onComplete();
          }, 625); // ì°¨ë‹¨ í›„ ì°½ ë‹«ê¸° ë”œë ˆì´
        }, 375); // ì°¨ë‹¨ í™•ì¸ ë²„íŠ¼ í´ë¦­ê¹Œì§€ ë”œë ˆì´
      } else {
        if (retryCount < 1) {
          console.warn(`ì°¨ë‹¨ ë²„íŠ¼ ì—†ìŒ. ìƒˆë¡œê³ ì¹¨ ì‹œë„ ${retryCount + 1}/1`);
          popup.location.reload();
          setTimeout(() => {
            tryBlock(popup, retryCount + 1, onComplete);
          }, 250); // ì¬ì‹œë„ ë”œë ˆì´
        } else {
          console.warn(`ì°¨ë‹¨ ì‹¤íŒ¨ (ìµœëŒ€ ì¬ì‹œë„): ì°½ ë‹«ê¸°`);
          popup.close();
          onComplete();
        }
      }
    }, 125); // ë©”ë‰´ ë¡œë”© ëŒ€ê¸°
  } catch (e) {
    console.warn('ë¬¸ì„œ ì ‘ê·¼ ì‹¤íŒ¨:', e);
    onComplete();
  }
}

// âœ… 3. ìˆœì°¨ ì‹¤í–‰
function processProfilesSequentially(profiles, index = 0) {
  if (index >= profiles.length) {
    console.log('âœ… ëª¨ë“  í”„ë¡œí•„ ì°¨ë‹¨ ì‹œë„ ì™„ë£Œ');
    return;
  }

  const url = profiles[index];
  const popup = window.open(url);

  if (!popup) {
    console.warn(`ğŸš« íŒì—… ì°¨ë‹¨ë¨ ë˜ëŠ” ì‹¤íŒ¨: ${url}`);
    setTimeout(() => processProfilesSequentially(profiles, index + 1), 375);
    return;
  }

  console.log(`ğŸ”— í”„ë¡œí•„ ì—´ê¸°: ${url}`);

  setTimeout(() => {
    tryBlock(popup, 0, () => {
      setTimeout(() => processProfilesSequentially(profiles, index + 1), 250);
    });
  }, 1250);
}

// âœ… 4. ì‹œì‘
if (blockprofile.length > 0) {
  processProfilesSequentially(blockprofile);
} else {
  console.warn("â— ì°¨ë‹¨í•  ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤. ì…ë ¥ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
}
